<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>iFixit Daten mit Minecraft Skin</title>
  <style>
    /* ...deine Styles bleiben so wie vorher... */
  </style>
</head>
<body>

  <div id="main">
    <h1 id="header">Lade...</h1>
    <input id="userid-input" type="text" placeholder="iFixit User-ID eingeben..." />
    <button onclick="loadUser()">Laden</button>

    <p id="usrdata">Lade Daten...</p>
  </div>

  <div id="skinbox">
    <strong>Minecraft Skin</strong><br>
    <input id="mcname-input" type="text" placeholder="Minecraft-Name optional..." />
    <button onclick="loadMinecraftSkin()">Skin laden</button>
    <img id="mcskin" src="" alt="" style="display:none" />
    <br><br>
    <button id="namemc-btn">Auf Namemc ansehen</button>
  </div>

  <div id="footer" style="margin-top: 3em; font-size: 0.9em; color: #888; text-align: center;">
    Powered by <a href="https://corsproxy.io" target="_blank" style="color: #bbb;">corsproxy.io</a> 
    & <a href="https://crafatar.com" target="_blank" style="color: #bbb;">Crafatar</a>. <br/>
    Made with ❤️ by <a href="https://linktr.ee/friesenjunge226" target="_blank" style="color: #fff; font-weight: bold;">Friesenjunge226</a>
  </div>
  
  <script>
    const proxy = "https://corsproxy.io/?";
    const input = document.getElementById("userid-input");
    const mcInput = document.getElementById("mcname-input");
    const skinImg = document.getElementById("mcskin");
    const namemcBtn = document.getElementById("namemc-btn");

    // Minecraft-Name lokal speichern & laden
    function getCurrentMinecraftName() {
      return localStorage.getItem("currentMinecraftName") || "";
    }
    function setCurrentMinecraftName(name) {
      if (typeof name === "string" && name.trim() !== "") {
        localStorage.setItem("currentMinecraftName", name.trim());
      }
    }

    // Userdaten laden
    function loadUser() {
      const userID = input.value.trim();
      if (!userID) return;
      localStorage.setItem("ifixitUserID", userID);
      fetchUserData(userID);
    }

    function fetchUserData(userID) {
      document.getElementById("header").textContent = "Lade...";
      document.getElementById("usrdata").textContent = "Lade Daten...";
      skinImg.style.display = "none";

      const targetURL = `https://www.ifixit.com/api/2.0/users/${userID}`;
      fetch(proxy + encodeURIComponent(targetURL))
        .then(res => {
          if (!res.ok) throw new Error("Antwort war nicht OK.");
          return res.json();
        })
        .then(data => {
          document.getElementById("header").textContent = `iFixit Stats von ${data.username}`;
          document.getElementById("usrdata").innerHTML = `
            <p><strong>Benutzername:</strong> ${data.username}</p>
            <p><strong>Reputation:</strong> ${data.reputation}</p>
            <p><strong>Beigetreten am:</strong> ${new Date(data.join_date * 1000).toLocaleDateString("de-DE")}</p>
            <p><strong>Badges:</strong> 🥉 ${data.badge_counts.bronze} | 🥈 ${data.badge_counts.silver} | 🥇 ${data.badge_counts.gold}</p>
            <p><strong>Link zum Profil:</strong> <a href="https://www.ifixit.com/User/${data.userid}" target="_blank">Hier klicken</a></p>
          `;

          loadMinecraftSkin(data.username);
        })
        .catch(err => {
          document.getElementById("header").textContent = "Fehler!";
          document.getElementById("usrdata").textContent = "Fehler beim Laden von Daten: " + err.message;
          console.error(err);
        });
    }

    // Minecraft Skin laden (von Input oder Default)
    function loadMinecraftSkin(defaultName) {
      const mcName = (mcInput.value || defaultName).trim();
      if (!mcName) return;

      setCurrentMinecraftName(mcName);

      fetch(`${proxy}https://api.mojang.com/users/profiles/minecraft/${mcName}`)
        .then(res => {
          if (!res.ok) throw new Error("Minecraft-Name nicht gefunden.");
          return res.json();
        })
        .then(data => {
          skinImg.src = `https://crafatar.com/renders/body/${data.id}?scale=7&default=MHF_Steve&overlay`;
          skinImg.style.display = "block";
        })
        .catch(err => {
          skinImg.style.display = "none";
          console.warn("Kein Skin gefunden:", err.message);
        });
    }

    // Namemc-Button Event
    namemcBtn.onclick = () => {
      const mcusername = getCurrentMinecraftName();
      if (!mcusername) {
        alert("Kein Minecraft-Name gesetzt!");
        return;
      }
      const url = `https://de.namemc.com/profile/${encodeURIComponent(mcusername)}`;
      window.open(url, "_blank");
    };

    // Init beim Laden der Seite
    window.onload = () => {
      const savedID = localStorage.getItem("ifixitUserID");
      if (savedID) {
        input.value = savedID;
        fetchUserData(savedID);
      } else {
        fetchUserData("4502323"); // Default: Friesenjunge
      }
      // Falls schon Minecraftname gespeichert, setze ihn ins Feld
      const savedMC = getCurrentMinecraftName();
      if (savedMC) {
        mcInput.value = savedMC;
        loadMinecraftSkin(savedMC);
      }
    };
  </script>

</body>
</html>
